import { isCharNumber, getNumberLeftAndRight, Index, replaceAt } from '../utils'

export { };

const test = `
???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1
`;

const task = `
???#???.#??####? 5,1,5
???#????.#??????? 2,1,6
??.??#??#????.???. 1,10,1,1
#??#.???#..?? 4,1,1,1
?????.???..?? 1,2,2,1
????##?..??#?? 1,4,5
?#???.??##?#?. 3,1,3,1
.#.?#...##.??.? 1,2,2,1,1
????????.??? 4,2,1,1
???????##??#?#?????# 2,3,1,1,5
..??#.#??. 1,1,1
?????????.?##. 8,3
.#?.????????? 2,6,2
?.??#?????#???.?? 8,2
???..??????#?##???? 2,13
.??..????#?. 1,3,2
?#?.???####?.? 1,5,1
????#?#?#.?#??. 7,2,1
.?#????????.?..?#?? 9,2
?#??????#??#?. 2,1,1,2
?.???????##??? 1,8,2
.#.??#???????.????# 1,3,1,1,1,4
????.?????.?. 1,1,3,1
??.?#?????#??? 2,3,4,1
?.?#.?????#??.?? 2,6
.#?#?#???.?? 1,6,1
?##???????# 5,1,1
????????????????#.? 2,7,3,1
?###??##???????#? 5,2,4,1
???????.???.????.# 2,1,2,2,1
??##?#?.#..?.#??.?? 6,1,1,1,1,2
?????#??#???.?#????# 1,7,1,3,1,1
.?.???#?????? 1,7,1
??.#???.#? 1,1
????.#?.#?. 1,1,1
????..#?????#?. 1,4,2
#?#??#.??.#?#?#??.? 1,4,1,1,3,1
?###?#????.???.??#? 6,1,3,2
##?????#?#??#.?????? 3,6,2,1,1,1
?.???#?#??#?#? 1,2,1,4
??.?#?###??????#?? 2,1,5,1,1,1
?.#???.??.#.? 1,1,1,1
.??##??#???. 4,4
??????##?## 1,3,2
??.?#??.#??## 1,3,1,3
??????????? 3,1,1
?.??#???.??#.??? 6,1,1,1
???#??###????? 1,6,1
???.#??.???????. 2,5
??#???????##??##?. 2,4,7
????##.?.???.??.#? 5,3,1,1
?#?????.##??.??#?#?? 1,3,2,1,6
.????????#???.????# 5,6,3
.?.????.?. 1,2,1
?.??#.#?#??##?????? 1,1,13
????.?##????.??.#.? 2,3,1,1,1,1
????.???????####???. 1,8
?.???.????#??.. 3,4
?????????#??????# 1,8,2,1
.??#???#..? 2,1
.?#???..??# 2,2
.??#???#?#?..?.?# 9,1,2
????##?.???#?#? 1,3,4
??####???.??# 7,3
?#?#?????#????# 3,1,1,1,2
.#.???#????? 1,5,1,1
.???#????#??#??????? 12,1,1,1
?????#.?#??#????? 1,3,2,1,2
?.??#?.??.??? 1,3,2,3
??##?.???? 5,1,1
??###?#?????#?. 4,4,2
??##?????#?#??.?##?. 12,3
??????##??#....# 7,1,1
????#???#?#.#?.? 1,6,1,1,1
???????###? 1,1,5
?#?????#???.?# 3,3,2
?#???????#?#?#. 1,1,3,1,1
#???#??.??#??? 2,1,6
??.??.???#?.?#?#??? 1,1,4,5
..?????#???##??? 1,7,1
??#?????.??????.?# 4,3,2,1
#?????#?#.??????? 7,1,1,1,2
?.#.?.#??.???? 1,1,2,3
#??#??#?##??????## 2,7,1,4
.#.?.???.? 1,1,1
????##?.?????.. 3,2
?#?#???#?#?????# 3,10
?#??#.###???????? 5,4,5
#?.#?.?##??###???? 1,2,3,5,1
???????#?.#. 1,1,1,1
.?????##?????? 1,9
??.#..????? 1,1,2
?#?#.?#?#???# 1,1,5,1
?##?????#? 6,1
??.?????#### 1,1,6
???.??#??#???.?##? 1,8,4
.?#.?????????? 1,5
????????#?#?#?? 8,1,2
.?.#???#??? 1,5,1
??.??#??????#?##?#?? 1,1,14
##?#.??..???? 4,1,1,1
..???.???.. 2,3
??.??#?.??. 3,2
.?#.??????????#??..# 1,1,7,1,1,1
??#.???????#???# 3,1,1,2,2
????.????? 1,1,3
???????#?.???#??#?? 1,2,3,2
.?..??#??#???#.? 1,8,1,1
????.?.##?.#??????? 3,2,4,2
???##??..????. 1,2,3
??.#.??.?##?#???# 2,1,1,6,1
?#??#?#?#??.??##.? 9,3
?.????##?????#?? 9,1
????#.??#.?? 3,2,1
?##.#?.???#.???#??? 2,1,1,1,6
???#.???#???????#??? 3,3,1,2,2
?????????.? 3,2
??#?.?##.??????? 1,2,3,1,4
??????????##?????? 5,1,5,1
?????????#??#?.. 1,3,3,2
.????#?.?? 3,2
.???#?????? 2,2
.?????##???#.?#? 2,6,1
?.?#.???????? 1,2,1,1
??.?#?#?.?? 1,3,1
??##?.?.???????.??#? 4,1,2,2
..?????.??# 2,2
????..#??#.???? 1,1,1,2,1
.????###??#?#?.?#? 10,2
#??#?#?.??????? 1,4,1,3
?.#???????????? 1,4,2,1,1
?#???..?.??? 3,1,1,1
?.????????????? 5,1,1
.??.?.???. 1,3
..??...#??? 2,1
???#???#??.?#.????. 1,7,1,2
?.??????##? 1,2,2
??.?#???#..??.?? 1,2,1,2,1
??#???###?#?.#?????. 4,6,2,3
?.##??.???##.? 2,5
?.?????#??????.??.?? 3,1
##??##?#??? 8,1
.?..?.????#????????? 1,1,5,2,2
.?#?#?#?##?.# 3,1,3,1
?#?????#?.???#?? 3,2,4
?.#?#????? 1,1,1
????.??#.??...???? 3,3,2,1,1
??.?#??.?.??.??? 2,1,1,1,3
.??????#.???####?... 7,5
.?????##..???#. 1,1,2,1,1
?#??#...???.? 4,2
?????###?? 1,3
.###????#.#. 8,1
?????#??.? 1,5,1
?#??????..?##?? 4,5
???#??##?..###?? 2,1,2,3,1
#.??.?#?????.#?????# 1,2,5,4,1
#??##???#?#?? 5,5
#?#??.?..? 4,1
???????#????.??#?# 3,2,1,1,1,1
.?.???????####????.. 1,1,1,1,5,1
?????..?##???#???? 4,7,1,1
???#?#??.?.??? 4,1,1,1
???.????#???? 6,1
.??#????#? 2,4
???#?#????#?#.???? 11,2,1
????#??????## 1,10
.??.#.#?#????#?.# 1,1,1,4,1
?..??#??#????# 1,2,3,1
.?.?#?#????.?. 1,6,1,1
??#?#???#? 1,5
?.????#??????##???# 2,2,2,3,1
??.?#.?..?? 2,2
?.#??##????.????#?.# 8,2,2,1
#??#??????? 2,1,2
.???##??.#????? 1,4,2,1
???#????..??#???#?#? 1,1,1,1,9
#??????.?. 2,3
#???#????.??? 7,1
?????.??..#????? 1,1,1,3,1
?#?#?#.???? 1,3,2
??.??##???? 1,3,1
?#??????#?#?#?.??#? 1,1,7,2
?????#???.#?#??#.??? 1,3,6,2
.???.??#?..# 1,3,1
????.?.#???????? 1,1,1,1,4
..??#??#?#.??##?? 7,3
?.???.?????? 2,1,2
???#????????..? 4,1
???????#.?.?#?.?. 8,2
?????#??.?? 6,2
?.??#?????##?? 3,8
#???##????# 7,1
##?#?#????#.#???#? 6,2,5
????.????##? 1,3,2
?.?##?.???#? 4,5
?????#.?#??.???## 3,1,4,1,2
.#?#???#????????#?? 5,5,3
????.????? 3,3
?#????#??#??????. 7,2,1
.??#.#.?##?#??? 1,1,1,4,1
????#???..? 3,4
?#?.???#???????## 1,1,1,7
?#??..#?#?? 2,3
??????#???##?#.?.?? 14,1,1
???.???..?.??? 3,2,1,3
?#?#?#?#????? 2,1,1,5
???????##??#? 1,1,6
???##?#?##??#..????? 1,10,1,1
??#??#.#??????? 5,6
??##?.?##???? 1,2,3,2
.?#?#???.??.??##?.?? 2,1,1,1,5,2
??#??#??#???.??.. 1,1,7,1
??..???#????##????# 1,1,2,7,1
.#??#?????##???..# 6,5,1
#.?.???.???#??..? 1,1,1,4,1
??#????#?#?#?? 2,1,6
?#?#?????.????##??#. 5,1,8
??.#???#..?? 1,1,1,1
#?#.?#?.???#? 1,1,3,3
???#???#?????##?.?? 1,1,1,9,1
?????#??#?????. 4,1,3
??#.?.???#??? 2,1,6
???#????#??.??? 8,1
??.????????????#? 3,4
##??#.#.#.??#???#? 5,1,1,7
???????#?##?????#??? 4,7,1,1,2
.?#..#.??#? 2,1,2
?.????.???????? 1,2
??.??###??#????.#? 10,2
???#???##??##?#.?. 8,2,1
?.???.?????? 1,1,5
??#?.#?#???..#?#? 1,1,1,2,3
.?.?##???#??#??# 1,3,4,1
.?#?.??.??????. 2,1,5
?#????#??? 1,4
.?????????????? 1,2,2
??##???#.???? 5,1,3
..##..?#?.?????? 2,3,3
???#?#??.?. 5,1
??.???##????.#????? 8,5
????#????..??? 4,1,1,1
.?.??##?#???? 1,5,3
???#????#####?.???? 14,3
#???#??##?#??.?#??? 1,1,5,2,3
.?#???#????##????? 1,11
?#.????#??????##??? 1,9,3
??##??????????##???? 4,9,1
.??????.#?#???#?.??? 4,7,2
??..?#?????.?.??. 1,7,1,1
???.??.?.??.#?### 2,2,1,2,5
??#????####??????. 2,10
.??#??#?#??#?? 1,1,6,1
.???..????#.??#??? 3,4,4
?????????#? 1,1,4
.#?????#??? 1,1,2
.??#?#???. 1,1,1
??..#?##??#?..? 1,1,6
??#.#??????#??.??#? 1,1,1,3,1,2
.?...??#.?? 1,2
?#?????#?.?.? 8,1
???#???#?#? 1,1,3
?.????#???#??##.??? 1,3,9,2
??##????????. 3,1,2
??????????? 1,2
..?.?##??????..?#? 9,3
??#?#?#.?.?#.#??.?#? 7,1,2,1,1,1
.?#???????#? 3,1,4
?????????????# 7,2,2
.#??.#.?#?## 1,1,4
???#??#??????? 1,8
#??.??#?#???#? 2,5,1
??#?###??#??. 6,2
?#?##??##?????#????? 17,1
??##??#??? 1,2,2
##??.??#?##?#?#??. 2,1,10
????##????? 1,2,2
?#??.?????#???? 2,1,2,2,1
#?.?#????#???#??#? 2,2,1,3,5
.#?##????.?###?? 8,3
#??#??#???.??.?? 1,2,2,2,1
..#?#..??#?##???#?#? 3,11
?#???.???.??????. 2,1,3,1,1
##??.??##????#.?.?? 2,6,1,2
.?.?#??#????.???? 5,1
##.???.?????.??. 2,1,4,2
?.???#?????? 1,3,4
????#??#?.? 2,1
???#?#?????.?###???? 1,4,1,1,7
?????????#?.? 3,2,1,1
??????..?.???? 2,1,1,1
#.?##?#???#??.??? 1,9,2
??##??#????#????? 4,1,4,1
.????.?#?????? 1,1,7
??#?..?????. 3,2,1
##?##???.?.????? 6,1,1,4
?#?#??#?...?. 1,5,1
??.????.???? 1,3,2
??.??#????.?? 3,1
.??.??????.??.?? 1,4,1,1,1
??.??????????..?? 1,4,1,1,1
..???..??? 1,1,3
??.??#?.?..?.##?## 1,1,1,1,5
#.?.???#?????#? 1,1,1,2,2
#??#???.?#?#? 5,4
?.????#????.?.# 6,2,1
.?????????.?? 1,1,2,1
?#?.??.??.????? 2,1,2,5
??.#.???#??##??? 2,1,8,1
?#??.#?#?????? 4,3,2,1
.????.#?.?????#?? 1,1,1,8
.#???###??... 1,5,1
.??#?#?##??? 1,1,1,3
???#???#?.????? 4,1,1,3,1
???.#.?#??#??? 1,1,5,1
##?.???##??. 2,2,3
??#???.?#????#?#.?? 5,3,4,1
??.??.?????. 1,2,1,1
?..?#?##?.????#?. 6,5
#????????? 1,2,3
?????.??????.?? 4,2,1
.???.?####? 1,1,6
.??.?#????......? 4,1
#????????#??? 1,1,3
?????.#.???#?#.????? 2,1,1,2,3,4
??.?#???#?#??????# 2,8,4
#???#?.???#?. 6,2
.???#.#???#??#..???? 1,1,1,5,1,1
?#?#????.????#?##? 7,1,3,2
#???.??????#??##? 2,1,1,1,4
?.??#..??? 2,1,1
?????#?.???.???# 1,2,2,1
.?#.???.??#..?? 1,3,1,1,1
.?#??#.?#?##?#???## 1,1,9,2
???##?#?????.. 6,2
????????##??#??##.? 5,9
?????#?#???? 1,4
.?????#????.????#??? 9,5
????.??#??#??? 3,9
??#????.#? 4,1
????##?.#????#.????? 6,1,4,1,1,1
?????.?#?#..?? 5,1,1,1
#??#????.????????#?# 2,3,1,10
??#.???#?. 1,3
?###????#.????????#? 7,1,1,4,2
?#.????##????. 1,8,1
..#.???#.#. 1,3,1
????.#?????#? 1,3,1,1
?.#.?????????#??#? 1,1,4,2,2,2
?#??.??#????? 1,1,1,5
.???##???#?#???.#? 7,1,1,1,1
?..?#?#??????#?#?.# 1,14,1
??.???.??? 1,2,3
?###?????#?? 4,2
#.?#.???##????? 1,2,7,1
.?#?##???#???#???? 2,11,1
#??#.??.??#????#?. 1,2,1,8
#?.???##?#???#??#? 2,1,2,1,5
?#.????????.?#??#? 2,1,5,3,2
???#?#????#?.???? 11,1
????..?#?#??..#?. 2,6,1
?.#??#?#???. 6,1
?.???????? 2,1
?.??????#?. 1,3
?????.????.????##?? 1,1,1,1,6
??#????????# 5,5
??#?..?#?? 3,4
??.????.????#?#???# 2,8
???#??#????? 1,6,2
???.?#????? 1,2,3
??????????.#?#??? 2,1,2,1,6
?#??????.?. 4,2
#.??.????.????#???. 1,1,1,1,8
?????????????#??## 1,9,1,3
???.?#?..?? 1,2,1
?##?..????????????? 3,11
???..??????? 3,1,1,1
.???????.??#? 4,2,1,1
#?#???#???###?? 1,1,8,1
?#??#????????.??#?? 4,1,2,5
?#?#?.?????? 3,1
?????#??#???? 2,1,2,2
#??????.?#.#??.?#??? 1,1,1,1,1,5
?#??#?#?????.##???.? 7,1,3,1
..?#??????#?.#.?? 4,3,1,1
????.??.??#??#?? 1,1,5
????#??????.?. 6,1
?#??##.???.????????? 6,3,4,1
???#????#?#???? 3,2,3
?????#??#???.? 5,1
??????..?? 1,4,1
..???#?#????.. 1,8
??.#??????.??.???? 2,2,1,1,2,2
#????.????#????????? 5,1,2,7
???#???.??#.??..? 2,4,1,1,1
??#.????.###? 1,1,1,3
?#???#???##?.?#??#.# 6,3,1,2,1
?#???#.??? 3,1,1
?##?.?.?##?# 3,5
?????#??????.#?? 8,1,1,1
???#???#?#### 1,1,1,4
??#??###?#..??. 4,5,2
..??????#?##? 1,7
#???.???##.???????? 1,1,1,2,1,5
??.#..?.#. 1,1,1
????#??#?.????.??? 7,1,1,1
.#???????.??#???. 2,5,3
.#?##.???..?.###? 1,2,3,1,4
?.#???.?.?##?????#?? 1,1,1,1,9
??????.????. 2,1,2
?#???.?#?#???? 4,4,1
#.??#?..??#?#??.# 1,1,1,7,1
?.#?????#.?#? 1,1,2,1
??#??????.???. 2,2,3
???.????#?.# 1,1,1,1
.?.??#?#??##?#.? 1,5,4
?.???????? 4,1
??#?.?????? 3,4
??.?#??###?# 1,9
#.????#.???#? 1,4,1,2
??.?.????#??. 2,7
???????#.??#???.?? 3,3,5,1
?????.???#??# 3,7
?###??#????.?? 7,1,1,1
.??#??.?##?? 5,4
??????????.??##?.?. 2,4,5
??##???.???.? 3,2
?#?.??.??#?# 1,2,3
??.???#????##?## 2,4,6
?????..#??#???#?# 1,1,1,4,4
#.?#?#????#??? 1,5,4
.????##?????????? 12,1
?##?#.??#.#.?? 5,2,1,1
###??.????###???? 5,8
#??#?#??????????# 1,4,3,3
??.#?????????.????#? 1,1,3,1,1,3
??.?#?#???.#???. 1,5,3
????????.##???.?#??? 5,1,2,1,5
..?###?#????.?.?? 9,1
.??????#??#????.?#?? 1,9,1,3
????###?????????#?? 6,8
#?###??????.??#??# 5,1,3,1,2
??????#??????# 2,2,6
??#??.#?#... 2,3
???#????????#?? 3,4
??.??#??#??##??? 1,11
?.??#????#??.???# 1,4,1,2,1
?##??#???.????.# 3,1,1,1,1
??##???#??.???.??#? 4,4,1,1,4
?.?.???.???????.?? 2,4
??.##?????. 2,1,1
?????#?##??? 1,1,4,2
?#?#????.#?.#?? 5,2,1,1,1
??????.?.??.#?. 4,1,1,2
??????#??????.?? 3,6
#?????#?.#???? 7,2,1
?#?#?##???.#?#????? 10,1,1,1,1
?#?????##?#??.#?? 2,1,1,5,3
#.????#???.?. 1,5,2,1
???????.??? 3,1,2
???.???..??#?? 1,3,5
?.##??????. 1,2,2
.#?#???.?.? 4,1
?######????.?# 8,2
?????????.????###??. 3,2,1,1,5
#?.#????.??# 2,1,2,2
???.???.#???.?#? 2,2,1,1,1
.???.##.???#???#. 1,2,4,1
?#.?????.?#?.??. 1,2,2,3
????.#?.?? 3,2,1
??##?#.?#?. 6,2
???.#??#.# 1,4,1
#?#????????#?#? 1,2,4,1,2
??????#????????.?. 1,6,2,1
??.?????..#? 1,1,1,1
??#?.?.??#????#???. 1,1,3,3
#???#?.???## 2,3,4
?????#??.???#?.??#?? 1,5,2,2,1,1
#??##?????#??????.? 1,14,1
?##???.??#?#???#? 6,2,6
?#??.##????#.? 3,3,1
??#.#??????? 1,1,2,1
????????#?# 1,5,1
?.???????? 1,1,1
???????#..?##. 2,2,1,3
?#.??.#?#??#?????? 1,1,1,1,4,2
????#??.??.?##???? 4,2
?????.?????#?#????? 5,4,4,1
#??.?#??.????? 2,3,4
.?..#????###??? 1,9
??#??#?##.?? 8,1
?..?#?#..??? 4,1
?#..????#???#??#? 1,7,4
..??.?????????? 1,1
#?.????????# 1,3,4
?#???##???..?##??? 8,5
.??.?.#?.#?#? 2,1,4
.?#.?##???#?##.??? 1,5,4,2
???#???#???# 3,6
..???.?#.???.?? 1,1
?#?????????##.? 2,1,4
??.#???#?? 2,2
?#??.??##?# 3,4
????????.? 1,1,1
.?#????#????##??#?? 1,12
?.???.??.?# 1,2
???#???##? 3,3
?#?#??.?#..###???.? 1,1,1,2,6,1
?..?#??????. 3,1
??.#?.??#?#? 1,5
?.##?#???.? 4,1,1
????.???#..? 2,1,2,1
??.??????#? 1,1,2
???.???.?????.???? 3,2,2,2,3
??????####???.???#? 12,2
???????????. 2,2
#??##...????.#?? 5,3,1
??..?????.????##. 2,1,2,1,3
??#?????.??? 3,1,1
???#?#.???# 4,2
?#??#????.?#?##?.?.? 3,1,1,6,1,1
?????#????##? 6,3
???#???#?#??? 1,1,6
?????..?#??#.? 1,2,4
???#?#?#.????#?##?# 1,1,1,1,10
???#?????#? 1,2,3
?.??.??????.? 1,1,2,2
????#????#??? 1,7,1
.?#.?.?#????.??###?? 2,5,5
?.??..????## 1,1,6
??.??.??.#?#?#??#. 1,1,1,5,1
???#?##?##?##??? 8,3
.???###???#?#?.???# 1,10,4
?.##?#????# 7,1
?#???#?.?.???? 4,1,1,2
?.?.?##???????. 5,1
.?????##?#?? 3,4,1
...????.?#???##.. 1,7
..????????.##?? 4,3,2
???????.???.? 2,1,1
.????????. 1,1,1
?.?#???#.????. 3,1,3
?.?.###.#??? 3,1
??????..???. 1,2,1,2
#??##??#?????. 1,3,6
??.???.?#. 1,1,1
?#.??????? 1,1,2
.#.??????#???? 1,5,5
?#??.????#? 2,1,1
????#?####..??#?#?#? 6,5
?#?.?#???.???#.? 2,2,2,4,1
#???.???????#?.?###? 1,1,1,3,5
??????#.??. 1,4
?.????#???##??.? 1,9
#????#.??#?#..####?? 1,1,1,1,1,6
.?#.????.?? 2,1,1
?????#????????????## 1,5,1,6
????##????.??..#. 1,3,1,1,1
?????###?????? 5,1,1
????.???????#?#?? 3,1,8
?????????.?.?#?###? 3,1,1,6
?#?????#???. 1,1,1,1
.?.#?#??#?#?#??#??#. 1,10,2,1
##?###?.?#? 6,1
????????##???#?? 1,1,7,3
??????????.??#??? 4,3
????#?#?.????#????#? 1,1,1,8,1
.#????#?#??. 1,1,5
?#??#??#??#??..? 9,3
#???#???#?????.? 6,1,3
??#?#?##????? 7,2
.??#?????. 2,1,1
???##?????.#?# 6,1,1
???#?#?#????#??.?? 7,1,1,1,1
??...????????#???..? 6,3
????.??#?#?.? 3,5,1
?????#??#??. 2,6
?#?.???#??#??#. 1,7,2
???#?#?????.????? 6,3,2
?#???#?????.?? 3,7,1
??#???.#.?. 5,1
???????.???.??? 2,3,2,3
?#.##????..?# 1,3,2,1
?#??#?.?#?#? 6,1,1
?????.?????. 3,5
??..?.?#????.?# 1,1,1,1,2
.?#?..?##?#?#? 1,7
??.??#??????## 7,2
?????????. 1,2
#?.??#??#?? 1,6
#???..????#????# 1,1,2,7
?#?????????##?? 1,6,3,1
?.#?#.?.???.? 1,1,1,3
???????????? 1,4,1
.????...##? 2,2
?????????? 2,1,1
?#.??????.? 1,6,1
.?.??.?#?? 1,1,4
???#?#??#??.?# 9,1
#????????.##??###.? 1,3,2,7
?#????#???. 4,1,1
??.???###???????.? 1,8,2,1
????????## 2,5
??.?#???#???.?? 1,1,1,1,2
?#?#..??.?#??.?.? 1,1,1,3,1
????..?#?. 1,1,1
.????#?.???????..?? 3,4
#?.?#.???#??#?#???? 2,1,3,1,4
???#?##?##.????#?? 1,5,1,2,1
..??.##??..?? 4,2
.#???..???.?????##?. 2,3,7
?#?#??????. 5,1
???.????#??#?#??.??? 1,1,8,2
????.#???#???#?? 1,1,7,1
?.??.??.#. 1,1
#???.#??.# 1,2,1
.????.##?.?? 1,1,2,1
????#?#??.??#??? 7,4
?????#.##???????? 4,2,2,1,1
???.?#?#?.??.? 1,4,2,1
???#???.?#?. 1,2,1,2
?.?..????#??..#? 1,2,1,1,2
????###??..???###??? 5,5
?#..??#?#?????? 1,7,1
#?..????#???????# 1,1,4,1,2
?#?????#?#?#????..# 12,1,1,1
#?#??#.???#??#?# 1,1,1,3,4
?.??#???#???#????? 1,1,1,8,1
??????.?#???? 4,1,2,1
?..#?#?#?#??#??????? 1,1,9,2,1
?...???#?#. 1,1,3
???.????.? 1,1,1
?????..??#?? 1,1,1,3
#???????.??#????##? 3,2,5,3
.?#??#??#?##?. 2,1,4
.?#???.#?? 3,3
.##?.?#..?? 3,1,1
??????#.??#. 1,3,1
??.?..#???? 1,3
??##.?#??#?#?#?#??? 2,2,9
?????????##????##?? 11,5
???#?.###.. 3,3
???#?.???.????.??# 5,2,1,2,3
??.???????????? 1,1,4,4
??.??????.?###??? 3,7
?#??#??##???????# 1,11,1
.#.??????..#?? 1,4,1
.?#??##.?? 5,1
#??#?????#??? 1,8
????????#??#. 1,9
??.?#??..?. 2,1,1
???#??#???.???#? 4,1,4
?#???.#??? 1,2,3
..#?#?????#??.????#? 9,5
?????????????# 11,1
??????#??#??#?? 1,2,9
?????#????#??? 3,3
#??????.?? 2,4
..??#??.?.??#??. 4,1
???##.?##???#?#? 3,4,3
?##.???#??????? 2,9
#.?.??????.????#???# 1,1,6,2,5
.?.##?##???##?? 5,2
?#???????.?#.#?#? 1,4,2,3
?.????#?????#??????# 1,6,1,2,2,1
##.????#???#. 2,1,2,3
.??#?..???.#?.?.?#?# 2,3,2,4
????????#??.????# 5,2,1,1,1
?#?????.#?#?# 5,1,1,1
??###.???##??#??? 5,5,2,1
?.??????????#??#???? 1,3,1,7,2
#??.???.?# 3,1,1
.??#?.?????.? 3,2,1,1
?????.???##??#???? 3,5,5
???..??###????#??. 1,12
??.???##?.????#?# 5,6
?.?#?????#????.? 1,7
?..??##??#???. 1,8
?#?#??.#.??? 5,1,1
.????.?..?##??.. 1,2,1,4
?##?#.?#.?#.???? 5,1,1,1
?##?????.?. 8,1
????#?##???# 1,1,4,2
??????????????? 6,2
???????##??????? 1,6,2
??????????#???. 2,3,3
????????..? 2,1
???????##????#?#??? 1,10,2
??#????#?????? 9,2
??#??????.? 4,1
?.???????? 1,1,1
???#?#.??#???? 3,3,2
.????.?#?#?##???#? 1,9,1
??###???##?#??????#? 6,9,1
??????####?.?.????.? 6,2
??#?.??#?#.#. 2,1,1,1
.?.???#??#####?#?. 1,1,1,8
??#??#???#??????#? 3,9,1,1
.#????###??#?#???? 1,10
?#??????...???#?..## 8,5,2
??#?.?##...?? 2,2
?##.?.??.?#?###? 2,2,5
?#??#????#?.? 3,7
??#?#??.???????.? 4,3,1,1
?#??#?.??...??#?? 5,5
??????#???. 1,3
.#???#?#..??? 7,1
.?.?#####? 1,7
??????#???#. 1,3,3
?...??#?.?.???. 4,2
.#.??.?#??? 1,2,2
???#??#??.##?.... 1,6,3
??#??..#?#.? 3,1,1
??###??????#??#??..? 4,10
???#.??#???.?.?#?? 1,1,6,3
?????#??#?.?#????.? 9,4
###.??????.??. 3,5,1
.??#???.??..??#???? 4,1,7
?????#?.##..???? 5,2,2
??#????#???#?.??#?? 13,3
?#???.????..#?? 1,4,2
??###?#?????????# 14,1
#???????###? 2,1,1,4
..???.??#.? 1,1
????.??#.? 2,1
???#??.#???###????? 4,8,1
.?.??.##????#??#?? 1,11
?.?#?????. 3,2
?.#???#???#??.?????? 7,3,5
?#?#.???#?#?#. 4,1,4,1
.????????? 1,1,2
???#..???###??? 4,5,1
???#????.? 3,1
?##?#???##???#??##?? 3,1,1,3,6
.?.??#?.???#?# 1,1,3,1
?.???.??????##?. 2,7
???##???#??#???#?.? 10,2
.???..#?####??#?#?? 1,1,7,5
?#???##?????#?.. 7,4
??#??.??.?. 1,2
????#?#??.. 3,1,1
???.??.?.?#?.#??. 2,2,3
#?????????.? 1,1,1,3
?????#?#??.?# 2,6,1
???#????????#?? 2,2,2
??.?.??##?##?? 1,1,8
.???????.#?..# 2,2,2,1
?#.#..??..?.?#?? 2,1,1,1,4
??????.#???#? 2,1,2,1
..???##????#???.?. 5,7
#???.?#..??????.?# 1,1,1,1,2,2
??.??.?.???? 1,1,1,3
??##???#???.?.?? 8,1
??#????.#? 3,1,1
#???###..#. 1,5,1
?..#???.?##???? 1,4
.????????#??##????? 6,1,7
.?#?#.???#??? 2,1,1,3
??.???#??#?#????#??? 1,13
????????#? 1,2,1
?????#????#??. 7,2,1
??????.#?#?#.? 3,5
...???##.?? 1,2
.?.?##??????.?. 1,4,1,1
?????#?.?#?#? 5,4
#?#??????..? 3,2
???????#?# 2,5
.????????. 1,3
???#??#?#?????.?. 1,1,4,1,1
????#??#?.#?#.## 4,3,2
?#?.?#????.#????#?# 2,3,1,1,4,1
.#??..???##?.?????#. 2,6,2,3
?????#?..##?##? 1,2,5
..#??#?????#??.??? 6,2,1
#???...??.?? 1,1,1,1
??????.???#??.????? 2,3,1,2,5
.#?..??????? 1,1,1,1
?????##?#?#? 2,7
???##????#??#???.?? 3,1,1,4,1
??#???.??..? 5,2,1
.??#?##??##????.?? 6,3,1,2
#?#???????#? 1,5,1,1
#.?????????? 1,5
.??..?????##??? 1,6
???###???##??.. 4,5
????????????? 1,5
?.#??#?????#????? 4,7
???????..?? 1,4,1
?.??.?#?###?#??#?.. 1,1,9,2
???..##?????#?#?.?? 2,6
?#..#??#??#?. 2,8
?#??????????? 3,6
?#??????????#.?? 1,1,2,3,1
###???????.?#??..? 7,1,2,1
???#??#?.? 4,2
?#.??#???### 1,2,4
???.????#? 1,1,2
????##??#?#???. 4,3,1
?????????????#?..? 1,1,2,4,1
????#??.?? 1,3,2
#?.?????#?. 1,5
?##??.?##????????? 4,2,3
?????..#.? 3,1,1
?###?.#??????.##?? 3,3,1,1,3
??.????..??#??# 1,2,1,2,1
##???????#????? 2,3,4
???.?.??#? 2,2
#??#??#..?????? 5,1,5
??.?????#?###.??.# 1,3,5,2,1
???#.???.#??? 3,1,2
?.???##???##???...? 5,6
???.?????.?..????... 1,1
????.?????.. 2,3
##.????#??###?#### 2,1,1,1,3,4
??#??#???#???## 9,3
????#?#.?? 5,2
.#??.??#??#? 1,1,7
#..?????.. 1,3
.????#?#.?.#?#.????? 7,3,2
.???..??#.#???? 1,1,1,1,1
???#???.???????#??## 7,5,2,2
##?#?#???????? 6,1,4
.????#????#????.??? 13,1,1
????.???#??? 1,2,1
.##??#.#.# 5,1,1
??????..?????. 5,2,1
?#?..#?##?.??. 2,5
#??.#.???.?#.?. 2,1,2,2,1
??.??#????#??? 1,1,7,1
?????.????#????.#??? 1,2,1,6,1,1
??.?#??????#??.?? 5,3,1
#.??#???.####?#??? 1,2,9
???.?.????#???###? 1,1,1,1,9
?#?????##??.?#??? 1,1,6,4
???#??##??. 1,1,4
..?##?#??#???? 3,4
???????.??? 1,1,1
?.#???.??????.?.#? 1,4,2,3,1,1
??#??#?#.?? 1,6,1
?.????..?.????? 2,3
?##?????#?#?##???? 14,1
???.?.??#????????? 2,1,3,1,2,1
?.???#.???.?.???.?? 1,3,3,1,1,1
.????####?#??#?? 1,12
?.#???#.#??????# 1,1,1,2,5
??#?#?.???? 2,1,3
????????...##??#?.?? 7,5
????????#?#???.? 1,4
???.????.?????#??#? 1,1,1,2,5
??????##?.??#? 5,1
#????#????#?#? 1,1,5
???#????#????.#???? 9,2,1,1
???#.???#???##??#? 2,1,2,3,1
?#???#???..?? 2,3,1,2
??????##?#?? 1,5
#?#??.?.???.??? 1,2,1,1,2
???????#??.??? 2,3,1,2
???#??#?#????? 2,6,2
?????#?#????.?.????? 1,5,1,1,2,1
?#??#?##?.???.??. 9,1,1
..#????????. 1,4,1
?.#??.##??? 3,3
.#?#????.????.?#? 3,2,3,2
??????#?.#? 6,2
???#????#???####??.? 3,1,9,1
?#????.????? 2,1,2
????#????. 1,7
??????###????? 2,5,3
.??#?##?#?#?# 6,5
???#???#???? 1,5,1
??????#?.#???.#? 7,2,2
.????##?##?#???#?? 1,1,2,8,1
?#?#??????????????? 8,3,1
???.??.?#? 1,1,1
#??..????? 1,1,1
?#??##?#?#?.#..? 2,3,1,1,1
?.#??????##??? 1,7
?????.?#??. 1,1,3
?.?????.???##..?. 4,5
???##??#?? 2,2
??#???#??#??#??#?? 3,1,1,2,4,1
.#????#???#?#?.? 2,2,2,2
#?##?.??.#???? 5,2,2,1
?.##???..?????##???. 5,10
???#???????? 1,3,1,2
???????#???#??? 2,4,4
.????????.??#????. 7,6
.?##?#?##?#? 5,5
???#??..##. 3,2
##?##???#????###.?? 2,4,8,1
???#.#..?##????#?#? 3,1,4,1,1
?????.?.###?????. 1,2,1,8
.??????#???? 4,2,1
?#.?##.??#??.? 1,3,4,1
??##??#????.??? 9,1
???.??.???.?#? 3,1,3,3
...#?????? 1,1,1
???#??#?..?#. 6,1
???#.??#?? 1,1,4
.?????#??? 1,1,1
???.??.?????#?? 2,1,1,3
.??##???.?#.? 4,1,1
???#?##?????.?? 1,9,1
.???#??????.?#? 1,2,2,1,3
.???#?.?.###???.?#?# 5,3,2,3
?#??.#.????#?##???? 2,1,2,4,1
??????????. 2,2,1
??????#???#????? 1,4,2,4
??..#?.#?????#?..? 1,1,8,1
?????..#?? 1,1,1
?????#?#?.?? 3,4
?????.#### 2,4
?##??.??## 3,1,3
??.?.#?????.? 1,1,1,2
?####?#?##??? 6,2,2
.??#??.?.???#? 1,3,2,1
#?#??????#?. 1,4,4
#.#????#?.????#??#?. 1,7,7
?????#.????????? 1,3,2,5
?#?.??#???? 2,2,3
?????#????#????.? 1,2,6,1
.???##?#???#?##?? 1,3,10
???????????#??##?.? 2,5
???.?#???? 1,1,1
#?????.#?????????#?. 1,1,1,8,2
#?????????????#??? 1,10,2,1
???#?#???# 1,7
?????#??#?##??##?? 1,5,6,1
?????????????? 1,1,1,5
.?.#.??.#??#???. 1,7
#?##????????. 4,1,2
???..????#?? 1,2
..?????????.##? 1,1,2,3
?#???##??.?.?.? 7,1,1
..??.???.? 1,3
??###?#?##?.?##?. 10,4
????????.??#?##??#?? 2,1,3,1,1,6
..???.???#?.??##??? 1,5,4
???#?.?#??.?????? 1,3,3,1,2
??###.?#??????.#?.? 5,2,4,2
.??????.?.#??.???? 5,1,1,3
##?##?#?.?? 8,1
?????#?..? 1,4,1
????##??#.?##???? 1,6,4
??..???#??#? 1,4,1
#?#????#???.#?. 1,1,4,1,2
?#??#???#???? 1,5,3
??.???##????#??#???# 1,1,12,1
??????#?#???#?????? 8,1,7
?????#..???#???# 4,3,1
????#.??#? 2,2
????.???.?? 3,2,1
??#????..?# 5,2
??#?#?#?#????????## 10,4
???????.#?#??# 1,1,4,1
??#??##???#??.. 3,8
??????#??.???? 1,2,2,3
.#??.??##..?.? 3,3,1
?????#?.??#.? 3,2
.???.##??#####???.? 2,2,5,2
??.??????.???#. 1,5,2,1
??#???????????#? 1,2,10
..##??#???.### 5,1,3
??.?????#?#?#???.#.? 1,1,7,1,1,1
???#???????#. 6,1
.?.?##?#????## 1,4,1,3
?????#???.???. 6,1
.#??.#??#?##?#??.? 1,1,1,7,1,1
???#?????#?#?? 3,4
..?##?????.???#????? 5,8
.?#?????.????.?. 1,1,1,3,1
??#??.##????? 4,2,4
?.#?#??#?? 1,4,1
???#?#?????????..?? 1,4,1,1,1,1
?#??????????.?.. 2,1,2,1,1
?#???????##?#????. 5,3,2,1
##?????#??# 5,4
.??.???#???###? 1,3,4
?##???#????.??#???#. 3,1,1,1,1,5
.?????###??#? 2,6
.??#?#????#??#.??#?? 12,3
???????##???#. 8,3
?#????##..???#? 8,1,2
.??#.#.?.???#?? 2,1,5
?###????????????#?? 6,3,7
??.??.?.#???.??##? 1,1,1,2,1,4
????.??.???? 1,1,1,1
?.#..?###..#?.? 1,4,2,1
????????????? 3,1,3,1
#??.????????? 2,1,3
#???#????????..?? 2,5,1,1
???#???????????? 8,2
??.??????##??? 1,6,1
..##????#???? 2,2,1,1
??##???#???????.? 1,3,6,1,1
.??##????# 5,1,1
.???????#?.? 1,1
?#???#?.#??..#...?# 4,1,1,1,1,1
.??.?#???###???. 1,4,6
?##????????.?###?#. 8,1,4,1
`;

// ???.### 1,1,3
// ??.### [] 1,1,3
// #??.### [1] 1,3 

// ?.### [X] 1,1,3
// #.?.### [1] 1,3 
// .#?.### [1] 1,3
// ##?.### [X] 1,3 

const cache = new Map<string, Map<string, number>>();

function addCache(guess: string, arrange: number[], value: number) {
    if (!cache.has(guess)) {
        cache.set(guess, new Map());
    }
    const guessCache = cache.get(guess);
    guessCache.set(arrange.join(","), value);
}

function getCache(guess: string, arrange: number[]): number {
    if (cache.has(guess)) {
        const guessCache = cache.get(guess);
        if (guessCache.has(arrange.join(","))) {
            return guessCache.get(arrange.join(","));
        }
    }
    return null;
}

function removeLast(guess: string, arrange: number[]): number {
    if (guess[guess.length - 1] === "#") {
        const lastSharp = arrange[arrange.length - 1];
        for (let i = guess.length - 1; i >= guess.length - lastSharp; i--) {
            if (guess[i] === ".") {
                return -1;
            }
        }
        return lastSharp;
    }
    return 0;
}

function checkVariants(guess: string, arrange: number[]): number {
    const cc = getCache(guess, arrange);
    if (cc) {
        return cc;
    }

    if (guess.length === 0) {
        return arrange.length > 0 ? 0 : 1;
    }
    if (arrange.length === 0) {
        return guess.indexOf("#") === -1 ? 1 : 0;
    }
    let counter = [...guess].filter(ch => ch === "?" || ch === "#").length;
    let sum = arrange.reduce((s, v) => s += v)
    if (counter < sum || sum + arrange.length - 1 > guess.length) {
        addCache(guess, arrange, 0);
        return 0;
    }
    const removeFromEnd = removeLast(guess, arrange);
    if (removeFromEnd) {
        let res = 0;
        if (removeFromEnd !== -1) {
            res = checkVariants(guess.substring(0, guess.length - removeFromEnd - 1), arrange.slice(0, arrange.length - 1));
        }
        addCache(guess, arrange, res);
        return res;
    }

    let i = 0;
    while (guess[i] === '.') i++;

    let j = i;
    while (guess[j] === '#') j++;
    const sharpActualCount = j - i;
    if (sharpActualCount === 0) {
        if (guess[j] === undefined) return 0;
        const var1 = "#" + guess.substring(j + 1);
        const var2 = guess.substring(j + 1);
        const res = checkVariants(var1, arrange) + checkVariants(var2, arrange);
        addCache(guess, arrange, res);
        return res;
    }

    if (sharpActualCount === arrange[0]) {
        const var1 = guess.substring(j + 1);
        const res = checkVariants(var1, arrange.slice(1));
        addCache(guess, arrange, res);
        return res;
    }
    if (sharpActualCount > arrange[0]) {
        return 0;
    }

    if (guess[j] === '?') {
        const res = checkVariants(guess.substring(i, j) + "#" + guess.substring(j + 1), arrange);
        addCache(guess, arrange, res);
        return res;
    }
    return 0;
}

function main(input: string) {
    const lines = input.split("\n").map(t => t.trim()).filter((t) => t);
    let sum = 0;

    for (const line of lines) {
        const cguess = line.split(" ")[0];
        const carrange = line.split(" ")[1].split(",").map(Number);
        let guess = cguess;
        let arrange = [...carrange];
        for (let i = 0; i < 4; i++) {
            guess = guess + "?" + cguess;
            arrange.push(...carrange);
        }
        // cache.clear();
        console.log("input: " + line + " memory: " + cache.size);
        const s = checkVariants(guess, arrange);
        console.log("var counter " + s);
        sum += s;
    }

    console.log(sum);
}

console.log("test");
main(test);
console.log("task");
main(task);
console.log("done");
